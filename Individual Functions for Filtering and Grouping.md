This file lists all the individual Lua functions, be they `onFilter` and `onGroup` functions, or other background functions used in the global Lua Configuration or elsewhere, that I've written and the situations they are suited for. They have been grouped according to function.



# Helper Functions

This section lists all those functions that help make understanding Simpletask (ST) easier. They are useful in understanding the input fields for in-built functions available from ST, which are listed [here](https://github.com/mpcjanssen/simpletask-android/blob/master/src/main/assets/script.en.md). They can also be used to understand some lua function return values as well.


```lua
-- General Syntax:

function onGroup(t, f, e)
    
    -- Some pre_processing if needed
    return parameter_value
end
```

This generic tool will then group all tasks according to the return value, which will be the parameter in question. For example, if you wish to know what `f.due` is, simply use:

```lua
function onGroup(t, f, e)
    return f.due
end
```

This will group the tasks according to the internal representation of the due date, which is a large number (~10 to 11 digits).

Some examples use `os.time()`. To understand what `os.time()` returns, instead of `f.due`, use `os.time()` in the above example. And to know exactly what the due or threshold or creation dates and times are for the corresponding internal representations stored in `f.due`, etc., use:

```lua
function onGroup(t, f, e)
    tim = f.due     --or os.time(), f.threshold, etc.
    return os.date("%c", tim)
end
```

Doing this will show that all due and threshold dates exceed `os.time()` at 00:00 hrs of the date listed by the user.

Similarly, if you wish to know exactly what due date ranges, and hence, tasks, will be covered by my time bound filters (listed subsequently), use:

```lua
function onGroup(t, f, e)
    
    tim = os.time()
    tim_d = tim-86400
    tim_w = tim+518400
    tim_m = tim+2505600 
    
    
    gr_name = ("Current Time: "..os.date("%c", tim).."\n\nOverdue task before (>=f.due): "..os.date("%c",tim_d).."\nToday task after (<f.due): "..os.date("%c",tim_d).."\nToday task before (>=f.due): "..os.date("%c",tim).."\nThis week task after (<f.due): "..os.date("%c",tim).."\nThis week task before (>=f.due): "..os.date("%c",tim_w).."\nThis month task after (<f.due): "..os.date("%c",tim_w).."\nThis month task before (>=f.due): "..os.date("%c",tim_m).."\nSomeday task after (<f.due): "..os.date("%c",tim_m))
    
    return gr_name
end
    
```

If you are testing with a todo list of few tasks, or just testing on a single task using the Test option in the script window, you can use the `toast()` function as well. This is particularly useful in understanding tables generated by Simpletask: `f.lists` and `f.tags` and the extensions (`e` in `(t, f, e)`). This is explored below.

###### Understanding Tables Generated by Simpletask

With a test task `(A) 2016-12-15 This is an example task with all features. @Testing @@Understanding_ST +Helper t:2016-12-15 due:2016-12-22 rec:+1d`, running:


```lua
function onFilter(t, f, e)
    
    for k, v in pairs(f.lists) do 
        toast_string = tostring(k)..": "..tostring(v)   -- ".." is for string concatenation in Lua
        toast(toast_string)
    end
end
```

will show all the keys and associated field values of the table `f.lists` (see the [Notes on Simpletask and Lua](Notes on Simpletask and Lua.md) file for details on keys and values).

Similarly, replacing `f.lists` in `for k, v in pairs(f.lists) do` with `f.tags` or `e` show the tag keys and extension fields associated with the task. (This was done because the Simpletask Lua Help manual does not describe exactly what the extensions are.)



# The `Lua Config` File

This is the Lua Config file I have at present. The functions defined are heavily commented, so no separate descriptions are provided.

```lua
toast('Hello')    -- Welcome message. Runs every time Simpletask starts or the lua configuration script is run.

---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------
-- BACKGROUND FUNCTIONS Needed for the functions defined under GROUPING AND FILTERING section
---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------

function tablelength(T)
		--[[Returns the number of keys in the table.
			Source: http://stackoverflow.com/questions/2705793/how-to-get-number-of-entries-in-a-lua-table/2705804#2705804]]

	local count = 0
	for _ in pairs(T) do count = count + 1 end
	return count
end

---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------

function sort_and_concatenate_keys(T)
    --[[Sort keys and convert to a multiline string.
        Sorting keys in table - Source: https://www.lua.org/pil/19.3.html]]

    a = {}            -- New table
    key_string = ""   -- Empty string

    for n in pairs(T) do table.insert(a, n) end
        -- Fill new table "a" with keys from "T" as values in "a"

    table.sort(a)    -- Sort keys

    for _, n in ipairs(a) do key_string = key_string..n..'\n' end
        -- Append sorted keys in empty string, separated by a newline
        
    key_string = key_string:sub(1, -2)	-- Delete extra newline character

    return key_string
end

---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------
-- GROUPING AND FILTERING FUNCTIONS: Group by due date or list or tag
---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------

function multigroup_by_list_or_tag(t, f, e, parameter)
	-- Group tasks by list or tag, and separately classify tasks with multiple lists/tags.

    if parameter == 'tags' then
        tbl = f.tags
        
    else tbl = f.lists
    end
    
    L = tablelength(tbl)
    
    if L == 0 then
        return "Unsorted"	-- No list/tag. Custom label. Adapted from built-in example code.
    
    elseif L == 1 then
        return next(tbl)	-- One list/tag. Return that value. Adapted from built-in example code.
    
    else return sort_and_concatenate_keys(tbl)	-- Multiple lists/tags. Group under multiline label.
    end
end

---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------

function filter_uncompleted_by_due_date(t, f, e, time_period)
	--[[Filter uncompleted tasks by due date. Valid ranges are: 'overdue', 'today', 'this week' (next 6 days after today), 
	    'this month' (next 3 weeks after this week), and 'someday' (sometime after the next 30 days, or no due date set)
		Note that "this week" and "this month" are moving windows. They are calculated from the current day. 
		Not from the Sunday, or the 1st of that month]]

    local curr_time, day, week, month = os.time(), 86400, 518400, 2505600
		--[[As f.due, os.time(), etc. return values in seconds:
				86400: Number of seconds in a day
				518400: Number of seconds in six days
				2505600: Number of seconds in 29 days (assuming a 30 day month)]]
    
    if time_period == 'overdue' then
        if f.due ~= nil then
            return curr_time-day >= f.due and f.completed == false
        end
        return false;
        
    elseif time_period == 'today' then
        if f.due ~= nil then
            return curr_time >= f.due and curr_time-day < f.due and f.completed == false
        end
        return false;
        
    elseif time_period == 'this week' then
        if f.due ~= nil then
            return curr_time < f.due and curr_time+week >= f.due and f.completed == false
        end
        return false;
        
    elseif time_period == 'this month' then
        if f.due ~= nil then
            return curr_time+week < f.due and curr_time+month >= f.due and f.completed == false
        end
        return false;
        
    elseif time_period == 'someday' then
        return f.completed == false and (curr_time+month < f.due or f.due == nil)
        
    else
        return false -- No valid time range given.
    
    end
end

---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------

function group_uncompleted_by_due_date(t, f, e)
	--[[Group uncompleted tasks by due date. Output ranges are: 'Already Overdue!!!', 'Due Today', 
	    'Due in the rest of this Week' (next 6 days after today), 'Due in the remainder of this Month' (next 3 weeks after this week), 
		and 'Can Afford to Procrastinate on these for now!' (sometime after the next 30 days, or no due date set)]]

    local curr_time, day, week, month = os.time(), 86400, 518400, 2505600	-- See above for details.
    
    if f.due ~= nil then
        if curr_time-day >= f.due and f.completed == false then
            return "Already Overdue!!!"
            
        elseif curr_time >= f.due and curr_time-day < f.due and f.completed == false then
            return "Due Today"
        
        elseif curr_time < f.due and curr_time+week >= f.due and f.completed == false then
            return "Due in the rest of this Week"
        
        elseif curr_time+week < f.due and curr_time+month >= f.due and f.completed == false then
            return "Due in the remainder of this Month"
            
        else
            return "Can Afford to Procrastinate on these for now!"
        end
    
    elseif f.completed == false then
        return "Can Afford to Procrastinate on these for now!"
        
    else
        return false
    
    end
end

---------------------------------- ---------------------------------- ---------------------------------- ----------------------------------


```



## onFilter and onGroup Functions

Once the above code is successfully imported and run (import it twice, if you are not pasting it, due to buggy behaviour), the following functions can be used in filter scripts:

### Show only not-completed tasks

```lua
function onFilter(t, f, e)
    return not f.completed
end

-- OR

function onFilter(t, f, e)
    return f.completed == false
end
```

### Show only completed tasks

```lua
function onFilter(t, f, e)
    return f.completed
end

-- OR

function onFilter(t, f, e)
    return f.completed == true
end
```

### Group tasks by list or tag, even those with multiple of them in a single task. Such tasks are classified separately.

```lua
-- Group by lists

function onGroup(t, f, e)
    return multigroup_by_list_or_tag(t, f, e)
end


-- Group by tags

function onGroup(t, f, e)
    return multigroup_by_list_or_tag(t, f, e, "tags")
end
```

### Filter uncompleted tasks by due date

```lua
-- Filter by due date: Overdue

function onFilter(t, f, e)
    return filter_uncompleted_by_due_date(t, f, e, "overdue")
end


-- Filter by due date: Due today

function onFilter(t, f, e)
    return filter_uncompleted_by_due_date(t, f, e, "today")
end


-- Filter by due date: Due in the next seven days, excluding today

function onFilter(t, f, e)
    return filter_uncompleted_by_due_date(t, f, e, "this week")
end


-- Filter by due date: Due in the next thirty days, excluding this week

function onFilter(t, f, e)
    return filter_uncompleted_by_due_date(t, f, e, "this month")
end


-- Filter by due date: Due after the next 30 days (including today), or no due date set

function onFilter(t, f, e)
    return filter_uncompleted_by_due_date(t, f, e, "someday")
end
```

### Group uncompleted tasks by due date (as shown in filters defined in the previous section)

If you sort by due date first, this results in something similar to the Any.Do layout, only, a lot more flexible, as you can define your own categories. If used in conjunction with one of the filter functions from the preceeding section, they would provide a header to the filter when opened in the main window.

```lua
function onGroup(t, f, e)
    return group_uncompleted_by_due_date(t, f, e)
end
```

Note that `onGroup`function return values only show up when you open Simpletask. Not in widgets, as of now.



# Saved Filters

These filters use a combination of Lua scripts and sorting and conventional filtering options to give diverse results. They appear in the right drawer. The Lua scripts themselves use a combination of the filtering and grouping finctions displayed above as needed.





